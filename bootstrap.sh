#!/bin/bash

set -e
set -u

cat <<EOF

                             ,,                 ?   ??I
                         ,,,,,,,,,,            ???77??? 7??7
                         ,,,,,,,,,,            ????????????
                       7,,,,=   ,,,,7     7??????      I??? 77
                       ,,,,,    :,,,,       ???          ??????
                          ,,,?+,,,~      777??            ???
                         ,,,,7,,,,,      ?????            7??
                         =+  ,,7?7:???     I??            7????
                             ,,I?????????? I??            ??77
                                ?I???????7?????          ???
                             I?????   ???II7 ????      ???????
                       ,,,    ?????   I????  ????????????   7
                  ,,:  ,,,  ,,,7???II????    ??   ??I  ??7
                  ?,,,,,,,,,,,7??????????         ??7,,7
               ,? ,,,,7    ,,,,7,, ??  ??      ,,,  :,,? =,,7
              +,,,,,         :,,,, 77           ,,,,,,,,,,,,
                ,,=           ,,?           ,: =,,,,,,,,,,,,=:,,
               ,,,             ,,,:         ,,,,,,,:    ,,,,,,,,
             ,,,,,             ,,,,          ,,,,,        ,,,,7
                ,,            ,,=           ,,,,,          ,,,,,,
               ,,,:          ~,,,         ,,,,,,,          :,,,,,=
              :,,,,,?       ,,,,,,  ??       ,,,,7         ,,,,
                  :,,,,,,,,,,, ?I  ???   ??  ,,,,,        ,,,,,
                  ,,, :,,, :,,????????????? ,,,,,,,,,++,,,,,,,,,7
                   +   ,,    7 ????????????  7  ,,,,,,,,,,,,
                          7?????????I??????????7,,,,,,,,,,,,7
                            ?????       7?????  ,,   ,,?  ,,7
                            ????7        7????       ,,
                         ???????         7??????7
                          ??????         7?????
                            ?????        ????7
                           ???????7    7???????
                           ????????????????????
                               ????????????
                              7??7 ???? I??I
                                    ??


EOF

echo -n "Install OS packages? [Y/n]: " && read INSTALL_PACKAGES
if [ "$INSTALL_PACKAGES" != "n" ]; then
    BASE_URL="https://raw.githubusercontent.com/ragnar-johannsson/dotfiles/master"

    case "`uname`" in
    Linux)
        if grep "Debian" /etc/issue >/dev/null 2>&1; then
            (wget -qO - $BASE_URL/deb-install.sh | bash) || true
        else
            echo "Error: Unsupported Linux distro"
            exit 1
        fi
        ;;
    Darwin)
        (curl -sSL $BASE_URL/osx-install.sh | bash) || true
        ;;
    esac
fi

if [ -e "$HOME/.dotfiles" ]; then
    echo "Error: $HOME/.dotfiles already exists"
    exit 1
fi

git clone https://github.com/ragnar-johannsson/dotfiles.git "$HOME/.dotfiles" && cd "$HOME/.dotfiles"

echo -n "Setup symlinks? [Y/n]: " && read SETUP_SYMLINKS
if [ "$SETUP_SYMLINKS" != "n" ]; then
    ./setup-links.sh
    echo "Installing Vim plugins..."
    vim +PlugInstall +qall
    echo "Installing Zsh plugins..."
    zsh -i -c "cat /dev/null"
fi

echo -n "Fetch keys? [Y/n]: " && read FETCH_KEYS
if [ "$FETCH_KEYS" != "n" ]; then
    ./setup-keys.sh
fi
